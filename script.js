document.getElementById("hamburger-btn").onclick=()=>document.getElementById("donasi-panel").classList.add("active");document.getElementById("close-donasi").onclick=()=>document.getElementById("donasi-panel").classList.remove("active");document.getElementById("donasi-panel").addEventListener("click",e=>{e.target===document.getElementById("donasi-panel")&&document.getElementById("donasi-panel").classList.remove("active")});document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("top-search"),t=document.getElementById("welcome-search-input"),n=document.getElementById("welcome-search-button"),a=document.getElementById("search-input"),o=document.getElementById("search-button"),i=document.getElementById("loading"),c=document.getElementById("video-feed"),l=document.getElementById("welcome-message");t.addEventListener("input",()=>a.value=t.value),a.addEventListener("input",()=>t.value=a.value);let d=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.querySelector("video");t&&(e.isIntersecting?(t.play().catch(()=>{}),e.target.classList.remove("paused")):(t.pause(),t.currentTime=0))})},{root:c,threshold:.7});async function s(t){if(!t.trim())return;i.style.display="flex",l.style.display="none",e.style.display="block",c.innerHTML="";try{const e=await fetch(`https://api.elrayyxml.web.id/api/search/tiktok?q=${encodeURIComponent(t)}`),n=await e.json();i.style.display="none",n.result&&n.result.length>0?r(n.result):u("Tidak ada video ditemukan.")}catch(e){i.style.display="none",u("Gagal terhubung ke server.")}}function r(e){const t=e=>e>1e6?(e/1e6).toFixed(1)+"M":e>1e3?(e/1e3).toFixed(1)+"K":e;e.forEach(e=>{const n=document.createElement("div");n.className="video-item",n.innerHTML=`<video class="video-player" loop playsinline poster="${e.cover}"><source src="${e.data}" type="video/mp4"></video><i class="fas fa-play play-pause-icon"></i><div class="video-overlay"><div class="bottom-layout"><div class="info-side"><div class="author-tag"><img src="${e.author.avatar}" onerror="this.src='https://via.placeholder.com/32'"><span>${e.author.nickname}</span></div><div class="video-desc">${e.title}</div><div class="music-tag"><i class="fas fa-music"></i><marquee scrollamount="4" style="max-width:150px;">Original Sound - ${e.author.fullname}</marquee></div></div><div class="action-side"><button class="action-btn"><i class="fas fa-heart icon-circle"></i><span class="action-text">${t(e.stats.likes)}</span></button><button class="action-btn"><i class="fas fa-comment-dots icon-circle"></i><span class="action-text">${t(e.stats.comment)}</span></button><button class="action-btn"><i class="fas fa-share icon-circle"></i><span class="action-text">${t(e.stats.share)}</span></button><button class="action-btn download-trigger"><div class="download-btn-special"><i class="fas fa-download"></i></div></button></div></div></div>`,c.appendChild(n),d.observe(n),n.addEventListener("click",t=>{if(t.target.closest(".action-btn"))return;const a=n.querySelector("video");a[a.paused?"play":"pause"](),n.classList.toggle("paused",a.paused)}),n.querySelector(".download-trigger").addEventListener("click",async t=>{t.stopPropagation();const a=t.currentTarget.querySelector(".download-btn-special"),o=a.innerHTML;a.innerHTML='<i class="fas fa-spinner fa-spin"></i>';try{const t=`https://api.nvidiabotz.xyz/download/tiktok?url=${encodeURIComponent(e.data)}`,n=await fetch(t),i=await n.json();if(i.status&&i.result&&i.result.video_hd){const e=document.createElement("a");return e.href=i.result.video_hd,e.download=`ONEDEV_${Date.now()}.mp4`,document.body.appendChild(e),e.click(),document.body.removeChild(e),a.innerHTML='<i class="fas fa-check"></i>',void setTimeout(()=>a.innerHTML=o,2e3)}}catch(e){}const i=document.createElement("a");i.href=e.data,i.download=`ONEDEV_${Date.now()}.mp4`,document.body.appendChild(i),i.click(),document.body.removeChild(i),a.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>a.innerHTML=o,2e3)})})}function u(e){c.innerHTML=`<div class="empty-state"><p>${e}</p></div>`}o.addEventListener("click",()=>s(a.value)),a.addEventListener("keypress",e=>{"Enter"===e.key&&s(a.value)}),n.addEventListener("click",()=>s(t.value)),t.addEventListener("keypress",e=>{"Enter"===e.key&&s(t.value)})});